#!/usr/bin/python
# -*- coding:utf-8 -*-
from numpy import *  # mat
from sklearn import neighbors
from sklearn import svm
from sklearn import tree


def numtofea(num, fea_list):
    feature = []
    for i in range(len(num)):
        if num[i] == '1':
            feature.append(fea_list[i])
        else:
            continue
    return feature


def read_data_fea(fea_list, dataset):
    dataMat = mat(dataset)
    col = dataMat.shape[0]  # 行号
    data_sample = []
    for i in range(col):
        col_i = []
        for j in fea_list:
            col_i.append(dataMat[i, j])
        data_sample.append(col_i)
    return data_sample


def acc_pre(label_pre, label_train):
    num = 0
    for i in range(len(label_pre)):
        if label_pre[i] != label_train[i]:
            num += 1
    return (1 - num / len(label_train))


def loadData(filename):
    numFeat = len(open(filename).readline().split('\t')) - 1
    feature = [];
    label = []
    fr = open(filename)
    for line in fr.readlines():
        xi = []
        curline = line.strip().split('\t')
        for i in range(numFeat):
            xi.append(float(curline[i]))
        feature.append(xi)
        label.append(float(curline[-1]))
    return feature, label


def train_knn(data_train, label_train, data_pre, label_pre):
    clf = neighbors.KNeighborsClassifier(n_neighbors=5)  # 创建分类器对象
    clf.fit(data_train, label_train)  # 用训练数据拟合分类器模型搜索
    predict = clf.predict(data_pre)
    acc = acc_pre(predict, label_pre)  # 预测标签和ground_true标签对比 算准确率
    return acc


def train_svm(data_train, label_train, data_predict, label_predict):
    clf = svm.SVC()
    clf.fit(data_train, label_train)
    predict = clf.predict(data_predict)
    acc = acc_pre(predict, label_predict)
    return acc


def train_tree(data_train, label_train, data_pre, label_pre):
    # dot_data=StringIO()
    clf = tree.DecisionTreeClassifier()
    clf.fit(data_train, label_train)
    # tree.export_graphviz(clf,out_file=dot_data)
    # graph=pydotplus.graph_from_dot_data(dot_data.getvalue())
    # graph.write_pdf('wine.pdf')
    predict = clf.predict(data_pre)
    acc = acc_pre(predict, label_pre)
    return acc


trainX, trainy = loadData(
    'C:/Users/Administrator/Desktop/install file/processed_data/arcene_train.txt')  # trainX,trainy are all list
predictX, predicty = loadData('C:/Users/Administrator/Desktop/install file/processed_data/arcene_valid.txt')
# original_acc=train_knn(trainX, trainy,predictX, predicty)
# original_acc=train_svm(trainX, trainy,predictX, predicty)
original_acc = train_tree(trainX, trainy, predictX, predicty)
num_fea_original = mat(trainX).shape[1]
feature = []  # 特征集合索引,特征集合的角标

for i in range(num_fea_original):
    feature.append(i)
print('将改进后的算法所算出的特征子集字符串直接带入分类器，得到相同的准确率即实验具备可重复性。*********************************************')

fea_list_CB = numtofea(
    '0001000000000000001000000000110000000001001000000000000000000100000010000000000000001010000000000000100000000000000000010100000000100000010011000000000000000000000000000000100000100000001000000010000010000000000000000000000000000000000001000100010000000000010101000000000100000000000010000000000100000001000000000000010000000000000000000001000000000000000000000000100111000100000100000000000000001000000000001000000000000001000010000000000000000000000001000001000000000000000000010000000000000010100000000000000001000000000000000000000100101010101000000000000000000000000000000010000001000000000000000000000001000000000000100000000100000000000000000000001101010100000000001000000000010010000000010000000001000000000000001101000000000000010000000000100000000000000001000000000000100000100000000011000010000000000000010000000110000000000000000000000000001000010110000100010000000000000001000000000000000000000000000000001010000000100000001000001000000000100001000000010101000001000000000000000001000000010100001100010001001000000000000000000000010000000001000000000000000000010000100000001000010000000000001100000000000000000001000000000000000000010000101000000000000000000000100000000000000000001000000000000000000000000000000001000000000100000000000000000001000000000000000000000100000000000100000000000000000000001000000000000010000000100000000000100000000000000000010000000010000000000000001000000000010000000010000000000000000100000100001010001000000001000100000100000100100010001010000000000000000000000100000000000000000000000001001000100001001100000000000000000000000000000000000000000000000000100000000000001011000000000000000001000000000000000000000010000000000000000000000000000001000001000000000000000000010000000000000000100000000001000010000001000000000011000111000001010000010000000000000000010000000001000000000010000000000000000101000000000100000000000000000000000000000101000000000000000000000000000000000000000000000000000001000000000000100001010000010000000000000110010000000110000000000000000000000000000001010000000000100000010101000000000000000000000100000000000000000000000100000000000000000001001000000010000101000010100000110000000000000000000000000000000000000010000000010000000000010010000000000100000001010011000000010010000001000100000000000001000000000000100000100000000000010000000000100000000000000100001000000000100000001000000000100000000000000000100000000000001000100000000000000010001001000010000000011000000000000000000000010000001101000000000000001010000000000000000110000000000000000000011000000000000000000000000010000000101000000000000000010000000000000000010000000000001000000000000000000100001000000000000000000000000000100000000000000000000000000000000000000000000000100000000100000000100101000010100000000010001000000001100000010110000000000100000000000000001000000000000001000000000000101000000000000000000011000000000000000010000000001001000001000000000000000001000000100000000001000000001000000001010000000010000100010000000000000000000000100100000000000011000000000000000000100000010000010000001000010000100000000000000100000000010000000000000000000000000000010000100100000000100000001000000100010000010000100010100000010000000000000100001100000100000000000000100000000000010000000100000010010110000000000000000000000000010000000000001100000000000000010010011000000001000000000000000000000000000010000100000000000100100000000000000000000000000000100100001000000000000000000000000010100000011000000000000001100000000001011000101000000000000010000000000001000000000000000000100100000000000000100000000010010000001000010000000000000000000000001000000000000000000001000010000010100000000000000000000001000000100001000000000000000000000000100000000000000000000000000001000001010000000000010000000001000100100100000000000000000000000000000010000000000001000010000000000000000000000000000000000000000000100000000000000010000000000000000010000100000001001001100100000000010000000000100000000100001000000000000000000000000000000100000000100000000000000000000000000010000000000000000000100000100000010000000000000000001000000000000000010000100101100000000001000011000000000000000000100000000000000100010000000000000100000001010000000000000001100010000000011000001000000000000000000000000001000000000010000000001100000000000010000010000000000000000000000000000000011000000000000000000000000000000000000000000100001000000000000000000010001000000000001000000000000001000100000000000100001001000100000000101001001000000010110001001010000000000001000000000110000000000000000000000100000000000000000000100000010000000000001000000001000001001000100001010001000100000100000000000000000000000000001000000000000000000000001010110000000000000000000000001000000000100001100000000000000010000000000000000000100000000000000000000000000000000010000000000100000000010000100000000100000000000001000000000000000000000000000000010000010000000000000000000000100000010000000000000001000000010000000000000000000000000000000000000001000000000000000000000000000000001000000000100011000000001001000000000001000000110100000000000100000000001000000000010000000001010110000010000100000010100000000000000001000001000000000000000000000010000000000000000000010000000000000100000000000000000101000000000000000000000010000000000100010000000000000000000000000100000000010000000000000000110000100000110000000000000000000010000000000000000000000000010000000100000001010000100000000000000001000000000000000001000000000100000000000000000000000010000000000000000000000000000000000000000011000001001000000000000100000000000010000000000000000000000001000100000010000000000001000000000000000000000010000100000100100000000000000000000000100100000000000000000000100000000000000000000000001010000010010100000000000000011000000000000000110000000000000000000000000010000000000000000000010100000000000000000010000000000000000000000100000100000000000010000100000000000000000101000000000000000000000000000000000001000000000000100000000000000000000000000000000000000001000000000100010000000000000010000000101000000000010000001000000000000000000000000000000000000000000000001000000010001000000010000010000000000011000001000000000000000001001000001000000001000000010001000000000000000000000000000000000000010000000000000000000000001000100010000100000010000000001000100000001010000100000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000100000000010100000000000000000000000000000000001100000000000001011001000000010100000100000000000000000000100000000000000000000010000000000000000000000000000000000000100000000110000100100110001010000000010000000000000000000000000000100010000000000000000000000000000000000000000000000000000000000001001000000011000000100000100000010000001000000000010000000000000100000011100000000000000100000001001000000000000000010000000000100000000000000000100010001000011000000000000001000000000000100001000000000000000000010000000000000000000000000000000001000001000001000000001000000000000100000000010000000001000000000000010000100010000000000010000000000100000100000100000010100000000000000000000000000100000000000000000010000000000100000100000000000000000100100000110000000100010000000100000100000010000000000100000000100000000000000000000000000000100000000000000100100100001001000010000000000000000100000001010000110000001001000000000000000000000100000000000010000000000000000000000000001000000000000000000000000001000000000000000001000000100010000100000000000000000000000000000011000000000000000010001000000011000000000100000000000000001000100000100000000000000000000000000000000000000000001000100001000000000000000001000000000000000001000000000001100010000100100100001110001000000000000010000000000000000000001100000100000000000100001011000000000001001000100000000000000000000000000000000010000010000001001100000000000000000000000000000000000000000010000010001000100000000010001000000000000000000000100000100000000001000000000000000100000010000000010010000000000000000010000000010000000000001000000000001000000000001000000000000000000010001100000000000000000000000101000000000001000000000000000000000000000000100000110000010000000000000000000000000000000000000000100000000000000000000100000000000000000100000000000000100001000000000000000010000000010100000000000011000100000000010100000000000000000001011000000000000000000000100000000000000000000000000100000000000000000010010000000000001000000100000100000100000100000001000000000000000001000100001010010000000000100000000000000000000000100001000100000000000001000000000000000000000100000100000100000000000000010000000000000000000000000001000000001000000000001100000000000000010000000101100010000000000000000000001000000000000001000000000000000000000001010000000110000000110001000001001000000000000000001000000000010000000000000000000000000000000001000000000000000000000000000000010000000001001000010000001001000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000010000000010000010100010010100000000000100001001000000010000000000000001001000100000000010000000000100001000000100111000000000000000000000000000000000000000000010000000010001000000000000001000000000000000101000100000000000000000000000000000010010000001000010000010100010001100001001110000000000000000101010000000100000100110000000010000000000000001000100000000100000000000000000000000000000100011000100101001000000001000010000100000000000000010001000000000000000000000000000000001011000000000000000000000010001100000100100000100010001000000000001000110100000000000000000000000000000000000000000100010000010000000010000000001001100010001010000010100000010001000000000000000001000000000000000001001100000000000000001000000000000000000000000000000100000000010001000000000000000100000000000000000000000000000100101000001010000000000000011000010001000000100000001010000000000000110001000000100000000001001000000000010000000100000000000100100000101100000000010000000000100000010000000000001100000000000000000000010010000000000000000000010000000000010000001000000000000100000',
    feature)
print('feature index ', feature)
print('fea_list_CB:', fea_list_CB)
data_sample = read_data_fea(fea_list_CB, trainX)
data_predict = read_data_fea(fea_list_CB, predictX)
print('原始准确率', original_acc)
for i in range(20):
    zhunquelvTREE = train_tree(data_sample, trainy, data_predict, predicty)
    # print('原始准确率',i, original_acc)
    print('准确率J48:', i, zhunquelvTREE)
    print('')
weidu = 1 - (len(fea_list_CB) / len(feature))
print('维度缩减：', weidu)



# fea_list_CB = numtofea('100101010010000000000000001000100000000000001000000000000000',feature)
# print('fea_list_CB:',fea_list_CB)
# data_sample = read_data_fea(fea_list_CB, trainX)
# data_predict = read_data_fea(fea_list_CB, predictX)
# zhunquelvKNN=train_knn(data_sample, trainy, data_predict, predicty)
# #zhunquelvSVM=train_svm(data_sample, trainy, data_predict, predicty)
# #zhunquelvTREE=train_tree(data_sample, trainy, data_predict, predicty)
# weidu=1 - (len(fea_list_CB) / len(feature))
# print('feature index ',feature)
# print('原始准确率',original_acc)
# print('准确率KNN:',zhunquelvKNN)
# #print('准确率SVM:',zhunquelvSVM)
# #print('准确率J48:',zhunquelvTREE)
# print('维度缩减：',weidu)
